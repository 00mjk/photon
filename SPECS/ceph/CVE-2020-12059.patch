From 799847a08549339ebdd8de464e6c1e2d0bf67d27 Mon Sep 17 00:00:00 2001
From: Abhishek Lekshmanan <abhishek@suse.com>
Date: Wed, 22 Apr 2020 11:24:34 +0200
Subject: [PATCH] rgw: check for tagging element in POST Obj requests

Check for null element when reading the tagging field from POST obj XML

Fixes: https://tracker.ceph.com/issues/44967
Signed-off-by: Sujay G <gsujay@vmware.com>
---
 src/rgw/rgw_rest_s3.cc | 3 +++
 1 file changed, 3 insertions(+)

diff -Nuar ceph-12.2.13.orig/src/rgw/rgw_rest_s3.cc ceph-12.2.13/src/rgw/rgw_rest_s3.cc
--- ceph-12.2.13.orig/src/rgw/rgw_rest_s3.cc	2020-05-04 15:01:13.292932309 +0530
+++ ceph-12.2.13/src/rgw/rgw_rest_s3.cc	2020-05-04 15:02:55.500937216 +0530
@@ -1720,6 +1720,9 @@
     RGWObjTagging_S3 *tagging;
 
     tagging = static_cast<RGWObjTagging_S3 *>(parser.find_first("Tagging"));
+    if (!tagging) {
+      return -ERR_MALFORMED_XML;
+    }
     obj_tags_s3 = static_cast<RGWObjTagSet_S3 *>(tagging->find_first("TagSet"));
     if(!obj_tags_s3){
       return -ERR_MALFORMED_XML;
