From 3926f5dbebe5a7f191c743a04b74160737acb282 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Patrick=20O=E2=80=99Brien?=
 <patrick.obrien@thetradedesk.com>
Date: Tue, 15 Oct 2019 13:29:18 -0700
Subject: [PATCH] Callback: removing args from task_fields from Sumologic and
 Splunk
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

CVE-2019-14864 Ansible: Splunk and Sumologic callback plugins leak sensitive data in logs

Fixes #63522

Signed-off-by: Patrick Oâ€™Brien <patrick.obrien@thetradedesk.com>
Signed-off-by: Abhijeet Kasurde <akasurde@redhat.com>
---
 .../63522-remove-args-from-sumologic-and-splunk-callbacks.yml  | 2 ++
 lib/ansible/plugins/callback/splunk.py                         | 3 +++
 lib/ansible/plugins/callback/sumologic.py                      | 3 +++
 3 files changed, 8 insertions(+)
 create mode 100644 changelogs/fragments/63522-remove-args-from-sumologic-and-splunk-callbacks.yml

diff --git a/changelogs/fragments/63522-remove-args-from-sumologic-and-splunk-callbacks.yml b/changelogs/fragments/63522-remove-args-from-sumologic-and-splunk-callbacks.yml
new file mode 100644
index 0000000000000..7af27d9082b07
--- /dev/null
+++ b/changelogs/fragments/63522-remove-args-from-sumologic-and-splunk-callbacks.yml
@@ -0,0 +1,2 @@
+bugfixes:
+  - '**security issue** - Ansible: Splunk and Sumologic callback plugins leak sensitive data in logs (CVE-2019-14864)'
diff --git a/lib/ansible/plugins/callback/splunk.py b/lib/ansible/plugins/callback/splunk.py
index 26b5d1d8853cd..4f0e7eec3c12d 100644
--- a/lib/ansible/plugins/callback/splunk.py
+++ b/lib/ansible/plugins/callback/splunk.py
@@ -98,6 +98,9 @@ def send_event(self, url, authtoken, state, result, runtime):
         else:
             ansible_role = None
 
+        if 'args' in result._task_fields:
+            del result._task_fields['args']
+
         data = {}
         data['uuid'] = result._task._uuid
         data['session'] = self.session
diff --git a/lib/ansible/plugins/callback/sumologic.py b/lib/ansible/plugins/callback/sumologic.py
index 4a2bd0b5bb09c..22e217f0b59e1 100644
--- a/lib/ansible/plugins/callback/sumologic.py
+++ b/lib/ansible/plugins/callback/sumologic.py
@@ -89,6 +89,9 @@ def send_event(self, url, state, result, runtime):
         else:
             ansible_role = None
 
+        if 'args' in result._task_fields:
+            del result._task_fields['args']
+
         data = {}
         data['uuid'] = result._task._uuid
         data['session'] = self.session
